{% extends "base.html" %}
{% block title %}Grade Submission - {{ student.get_full_name|default:student.username }}{% endblock %}

{% block content %}
    <section class="section section--soft">
        <div class="container">
            <!-- BACK BUTTON -->
            <div style="margin-bottom: 32px;">
                <a href="javascript:history.back()" style="color: var(--teal2); text-decoration: none; display: flex; align-items: center; gap: 8px;">
                    ‚Üê Back
                </a>
            </div>

            <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <!-- HEADER -->
                <div style="margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid #eee;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 24px; margin-bottom: 16px;">
                        <h1 style="margin: 0;">{{ assignment.title }}</h1>
                    </div>
                    <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                        <div>
                            <span style="color: var(--muted); font-size: 0.9rem;">Student:</span>
                            <span style="font-weight: 600;">{{ student.get_full_name|default:student.username }}</span>
                        </div>
                        <div>
                            <span style="color: var(--muted); font-size: 0.9rem;">Email:</span>
                            <span style="font-weight: 600;">{{ student.email }}</span>
                        </div>
                        <div>
                            <span style="color: var(--muted); font-size: 0.9rem;">Status:</span>
                            <span style="display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
                                {% if submission.status == 'submitted' %}
                                    background: #e3f2fd; color: #1565c0;
                                {% elif submission.status == 'graded' %}
                                    background: #e8f5e9; color: #2e7d32;
                                {% elif submission.status == 'late' %}
                                    background: #fff3e0; color: #e65100;
                                {% endif %}
                            ">
                                {{ submission.get_status_display }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- SUBMISSION DETAILS -->
                <div style="margin-bottom: 32px;">
                    <h2 style="margin-bottom: 16px;">Submission File</h2>
                    {% if submission.file %}
                        <div style="background: #f5f5f5; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <a href="{{ submission.file.url }}" target="_blank" style="color: var(--teal2); text-decoration: none; display: flex; align-items: center; gap: 8px;">
                                üìÑ {{ submission.file.name|default:"Download submission" }}
                            </a>
                        </div>
                    {% else %}
                        <p class="muted">No file submitted.</p>
                    {% endif %}

                    {% if submission.comment %}
                        <div style="margin-top: 16px;">
                            <strong>Student Comment:</strong>
                            <p style="background: #f9f9f9; border-left: 4px solid var(--teal2); padding: 12px; border-radius: 4px;">
                                {{ submission.comment }}
                            </p>
                        </div>
                    {% endif %}
                </div>

                <!-- GRADING FORM - ONLY FOR TEACHERS/ADMINS -->
                {% if request.user.role != 'student' %}
                <form method="post" style="margin-bottom: 32px;">
                    {% csrf_token %}

                    <div style="margin-bottom: 24px;">
                        <label for="grade" style="display: block; margin-bottom: 8px; font-weight: 600;">Grade (0-100)</label>
                        <input type="number" id="grade" name="grade" min="0" max="100" value="{{ submission.grade|default:'' }}"
                               style="width: 100%; max-width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                    </div>

                    <div style="margin-bottom: 24px;">
                        <label for="comment" style="display: block; margin-bottom: 8px; font-weight: 600;">Feedback</label>
                        <textarea id="comment" name="comment" rows="6" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 1rem;">{{ submission.comment|default:'' }}</textarea>
                    </div>

                    <!-- Status is auto-determined based on grade -->
                    <input type="hidden" name="status" value="{% if submission.grade %}graded{% elif submission.status == 'late' %}late{% else %}submitted{% endif %}">

                    <div style="display: flex; gap: 12px;">
                        <button type="submit" style="padding: 10px 24px; background: var(--teal2); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                            ‚úì Save Grade & Feedback
                        </button>
                        <button type="button" onclick="history.back()" style="padding: 10px 24px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                            Cancel
                        </button>
                    </div>
                </form>
                {% else %}
                <!-- STUDENT VIEW - SHOW GRADE AND FEEDBACK ONLY -->
                {% if submission.grade is not None %}
                <div style="margin-bottom: 32px; padding: 20px; background: var(--soft); border-radius: 12px; border-left: 4px solid var(--teal2);">
                    <h3 style="margin-top: 0;">Your Grade & Feedback</h3>

                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--muted); font-weight: 600;">Grade</label>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--teal2);">{{ submission.grade }}/100</div>
                    </div>

                    {% if submission.comment %}
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: var(--muted); font-weight: 600;">Teacher Feedback</label>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 4px solid var(--teal2);">
                            {{ submission.comment }}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div style="margin-bottom: 32px; padding: 20px; background: #fff3e0; border-radius: 12px; border-left: 4px solid #ff9800;">
                    <p style="margin: 0; color: #e65100; font-weight: 600;">‚è≥ Awaiting Teacher Feedback</p>
                    <p style="margin: 8px 0 0 0; color: #f57c00; font-size: 0.9rem;">Your submission has been received. The teacher will review and provide feedback soon.</p>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </section>
{% endblock %}

