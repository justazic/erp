{% extends "base.html" %}

{% block title %}Assignments | TOTC{% endblock %}

{% block content %}
    <section class="section section--soft">
        <div class="container">
            <div class="dash__top" style="margin-bottom: 32px;">
                <div>
                    <h2 class="h2">Learning <span class="accent">Assignments</span></h2>
                    <p class="muted">Manage and track course assignments.</p>
                </div>

                {% if request.user.role == 'teacher' %}
                    <div class="dash__quick">
                        <a href="{% url 'tasks:assignment_create' %}" class="btn btn--pill btn--primary">
                            Create Assignment
                        </a>
                    </div>
                {% endif %}
            </div>

            <!-- SEARCH BAR -->
            <div class="center" style="margin-bottom: 32px;">
                <form method="get" style="display: inline-flex; width: 100%; max-width: 600px; gap: 10px;">
                    <input type="text" name="search" placeholder="Search assignments..." 
                           style="flex: 1; padding: 12px 20px; border-radius: 999px; border: 1px solid #ddd;"
                           value="{{ search|default:'' }}">
                    <button type="submit" class="btn btn--pill btn--primary">Search</button>
                </form>
            </div>

            <div class="dashGrid" style="grid-template-columns: 1fr;">
                {% for a in assignments %}
                    <div class="dashCard" style="display: flex; justify-content: space-between; align-items: center; padding: 24px;">
                        <div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <h3 style="margin: 0; font-size: 20px;">{{ a.title }}</h3>
                                <span class="badge">{{ a.group.name }}</span>
                                <span class="badge" style="background: var(--soft); color: var(--ink);">{{ a.get_status_display }}</span>
                            </div>
                            <p class="muted small" style="margin-bottom: 8px;">{{ a.description|truncatewords:20 }}</p>
                            <div class="tiny muted">
                                ðŸ“… Deadline: <strong>{{ a.deadline|date:"M d, Y H:i" }}</strong>
                                {% if request.user.role == 'teacher' %}
                                    â€¢ ðŸ‘¥ {{ a.submissions.count }} Submissions
                                {% endif %}
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            {% if request.user.role == 'student' %}
                                <a href="{% url 'tasks:submission_create' a.id %}" class="btn btn--pill btn--primary">
                                    Submit Work
                                </a>
                            {% elif request.user.role == 'teacher' %}
                                <a href="{% url 'tasks:submission_list_teacher' a.id %}" class="btn btn--pill btn--outlineTeal">
                                    View Submissions
                                </a>
                                <form method="post" action="{% url 'tasks:assignment_delete' a.id %}" onsubmit="return confirm('Are you sure?')">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn--pill btn--white" style="color: var(--pink); border-color: var(--pink);">Delete</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% empty %}
                    <div class="center card" style="padding: 64px; background: #fff; border-radius: 20px;">
                        <p class="muted">No assignments found.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
{% endblock %}